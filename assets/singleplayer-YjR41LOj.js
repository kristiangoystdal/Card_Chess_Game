import{_ as v,q as D,s as f,w as i,c as s,G as T,H as O,y as w,I,J as M,v as _,E as P,K as V,x as C,L as G,A as b,F as k,D as S,M as j,z as x,C as H}from"./index-Dy1NA2zH.js";import{V as p,a as y,b as B}from"./VTextField-Dsun9YRr.js";import{o as q,c as W,a as A,b as K,d as R,e as $,f as L,g as z,h as E,i as N,j as F,k as U,l as J,m as Q,n as X,_ as Y}from"./card_wild_w-Bx4scEuD.js";const Z={name:"GameOverConfirmation",props:{gameWinner:{type:String,default:null},player1:{type:Object,required:!0},player2:{type:Object,required:!0}},computed:{isGameOver(){return this.gameWinner!==null},winnerString(){switch(this.gameWinner){case"white":return"White Wins!";case"black":return"Black Wins!";case"draw":return"It's a Draw!";default:return""}}},methods:{leaveGame(){this.$emit("close")}}};function ee(a,e,t,u,l,r){return f(),D(G,{modelValue:r.isGameOver,"onUpdate:modelValue":e[0]||(e[0]=o=>r.isGameOver=o),"max-width":"400"},{default:i(()=>[s(T,{class:"game-over-card"},{default:i(()=>[s(O,{class:"text-h5 font-weight-bold text-center"},{default:i(()=>[w(I(r.winnerString),1)]),_:1}),s(M,{class:"text-center"},{default:i(()=>[s(p,null,{default:i(()=>[s(y,{class:"text-center"},{default:i(()=>{var o,d,n;return[s(P,{src:((o=t.player1)==null?void 0:o.avatar)||a.blank_avatar,alt:((d=t.player1)==null?void 0:d.username)||"Player 1",class:"avatar-img"},null,8,["src","alt"]),_("p",null,I(((n=t.player1)==null?void 0:n.username)||"Player 1"),1)]}),_:1}),s(y,{class:"text-center"},{default:i(()=>{var o,d,n;return[s(P,{src:((o=t.player2)==null?void 0:o.avatar)||a.blank_avatar,alt:((d=t.player2)==null?void 0:d.username)||"Player 2",class:"avatar-img"},null,8,["src","alt"]),_("p",null,I(((n=t.player2)==null?void 0:n.username)||"Player 2"),1)]}),_:1})]),_:1})]),_:1}),s(V,{class:"justify-center"},{default:i(()=>[s(C,{color:"primary",onClick:r.leaveGame},{default:i(()=>e[1]||(e[1]=[w("Close")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ae=v(Z,[["render",ee],["__scopeId","data-v-92c1b118"]]),te={name:"ChatBox",data(){return{}},methods:{}};function re(a,e,t,u,l,r){return f(),b(k,null,[s(p,null,{default:i(()=>[s(y,{class:"d-flex justify-center"},{default:i(()=>e[0]||(e[0]=[_("h2",null,"Chat",-1)])),_:1})]),_:1}),s(p,null,{default:i(()=>[s(y,null,{default:i(()=>[s(B,{label:"Chat is currently disabled... Stay tuned",outlined:""})]),_:1})]),_:1})],64)}const ne=v(te,[["render",re]]),se={name:"GameOptions",emits:["offer-draw","resign"],data(){return{}},props:{offeredDraw:{type:Boolean,required:!0}},methods:{offerDraw(){this.$emit("offer-draw")},resign(){this.$emit("resign")}}};function le(a,e,t,u,l,r){return f(),b(k,null,[s(p,null,{default:i(()=>[s(y,{class:"d-flex justify-center"},{default:i(()=>e[2]||(e[2]=[_("h2",null,"Options",-1)])),_:1})]),_:1}),s(p,{class:"d-flex justify-center game-options"},{default:i(()=>[s(C,{color:"primary",onClick:e[0]||(e[0]=o=>a.$emit("offer-draw")),disabled:t.offeredDraw},{default:i(()=>e[3]||(e[3]=[w(" Offer Draw ")])),_:1},8,["disabled"]),s(C,{color:"error",onClick:e[1]||(e[1]=o=>a.$emit("resign"))},{default:i(()=>e[4]||(e[4]=[w(" Resign ")])),_:1})]),_:1})],64)}const ie=v(se,[["render",le],["__scopeId","data-v-090e1ad3"]]),oe={name:"CardManagement",emits:["redrawCard","passTurn"],props:{myCardHand:{type:Array,required:!0},myColor:{type:String,required:!0},cardTypes:{type:Array,required:!0}},data(){return{selectedCardIndex:null}},methods:{selectCard(a){this.selectedCardIndex===a?this.selectedCardIndex=null:this.selectedCardIndex=a},redrawCard(a){this.$emit("redraw-card",a,this.selectedCardIndex),this.selectedCardIndex=null},passTurn(){this.$emit("pass-turn")}}};function de(a,e,t,u,l,r){return f(),b(k,null,[s(p,null,{default:i(()=>[s(y,{class:"d-flex justify-center"},{default:i(()=>e[2]||(e[2]=[_("h2",null,"My Hand",-1)])),_:1})]),_:1}),s(p,null,{default:i(()=>[(f(!0),b(k,null,S(t.myCardHand,(o,d)=>(f(),D(y,{cols:"4",key:d},{default:i(()=>[s(P,{src:t.cardTypes.find(n=>n.type===o&&n.color===(t.myColor||"white")).image,onClick:n=>r.selectCard(d),style:j({border:d===this.selectedCardIndex?"2px solid red":"none",borderRadius:"20px"})},null,8,["src","onClick","style"])]),_:2},1024))),128))]),_:1}),s(p,{class:"d-flex justify-center card-actions flex-column"},{default:i(()=>[s(C,{color:"warning",onClick:e[0]||(e[0]=o=>r.redrawCard("player1")),disabled:l.selectedCardIndex===null},{default:i(()=>e[3]||(e[3]=[w(" Redraw Card ")])),_:1},8,["disabled"]),s(C,{color:"error",onClick:e[1]||(e[1]=o=>r.passTurn())},{default:i(()=>e[4]||(e[4]=[w(" Pass Turn ")])),_:1})]),_:1})],64)}const ce=v(oe,[["render",de],["__scopeId","data-v-cf674441"]]),ue={name:"GamePage",data(){return{gameId:"",gameData:null,handSize:6,cardTypes:[{type:"p",color:"black",image:W},{type:"p",color:"white",image:A},{type:"n",color:"black",image:K},{type:"n",color:"white",image:R},{type:"b",color:"black",image:$},{type:"b",color:"white",image:L},{type:"r",color:"black",image:z},{type:"r",color:"white",image:E},{type:"q",color:"black",image:N},{type:"q",color:"white",image:F},{type:"k",color:"black",image:U},{type:"k",color:"white",image:J},{type:"w",color:"black",image:Q},{type:"w",color:"white",image:X}],cardProbabilities:{p:27,n:17,b:17,r:13,q:10,k:10,w:6},selectedCardIndex:null}},async created(){const a=H();this.gameId=a.params.gameId,await this.createGame()},methods:{async createGame(){const a=["white","black"],e=Math.floor(Math.random()*a.length),t=a[e],u=a[(e+1)%a.length],l={userId:localStorage.getItem("userId")||"player1",username:localStorage.getItem("username")||"Player 1",color:t,hand:[],avatar:null},r={userId:"opponent",username:"Opponent",color:u,hand:[],avatar:null};for(let d=0;d<this.handSize;d++)l.hand.push(this.drawCard()),r.hand.push(this.drawCard());const o=new q.Game;this.gameData={player1:l,player2:r,game:o,createdAt:Date.now(),mode:"singleplayer",offeredDraw:!1},this.gameId="gameId",l.color==="black"&&this.makeAIMove()},drawCard(){const a=Object.values(this.cardProbabilities).reduce((l,r)=>l+r,0),e=Math.floor(Math.random()*a);let t=0,u=null;for(const[l,r]of Object.entries(this.cardProbabilities))if(t+=r,e<t){u=l;break}if(!u){console.error("No card type found for random value:",e);return}return u},updatePlayerHand(a,e){if(this.gameData){const t=this.gameData[a];if(t&&t.hand.length<this.handSize){const u=this.drawCard();t.hand.splice(e,0,u)}this.gameData[a]=t}},makeAIMove(){const e=this.gameData.player2.hand,t=this.gameData.game,u=t.moves(),l=[];for(const d in u)for(const n of u[d]){const c=t.board.configuration.pieces[d];if(!c)continue;const h=c.toLowerCase();(e.includes(h)||e.includes("w"))&&l.push({from:d,to:n,piece:c})}if(l.length===0){console.warn("AI has no legal moves it can make with its current hand.");const d=Math.floor(Math.random()*e.length);e.splice(d,1),this.gameData.player2.hand=e,this.updatePlayerHand("player2",d),console.warn("Passing turn to player 1."),this.passTurn();return}const r=l[Math.floor(Math.random()*l.length)];t.move(r.from,r.to);let o=e.indexOf(r.piece.toLowerCase());o!==-1?e.splice(o,1):(o=e.indexOf("w"),o!==-1&&e.splice(o,1)),this.updatePlayerHand("player2",o),this.gameData.player2.hand=e,this.gameData.currentTurn="player1",this.gameData.game=t},getLegalMoves(a,e,t,u){const l=[],r=(n,c)=>u[n][c].color!==a.color&&u[n][c].type!=="blank",o=(n,c)=>u[n][c].type==="blank",d=(n,c)=>n>=0&&n<=7&&c>=0&&c<=7;if(a.type==="pawn"){const n=a.color==="white"?1:-1;d(e+n,t)&&o(e+n,t)&&l.push({row:e+n,col:t}),d(e+n,t-1)&&r(e+n,t-1)&&l.push({row:e+n,col:t-1}),d(e+n,t+1)&&r(e+n,t+1)&&l.push({row:e+n,col:t+1})}if(a.type==="king"){const n=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[c,h]of n){const m=e+c,g=t+h;d(m,g)&&(o(m,g)||r(m,g))&&l.push({row:m,col:g})}}if(a.type==="knight"){const n=[[-2,-1],[-1,-2],[1,-2],[2,-1],[2,1],[1,2],[-1,2],[-2,1]];for(const[c,h]of n){const m=e+c,g=t+h;d(m,g)&&(o(m,g)||r(m,g))&&l.push({row:m,col:g})}}if(a.type==="bishop"||a.type==="rook"||a.type==="queen"){const n=a.type==="bishop"?[[-1,-1],[-1,1],[1,-1],[1,1]]:a.type==="rook"?[[-1,0],[0,-1],[0,1],[1,0]]:[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[c,h]of n){let m=e+c,g=t+h;for(;d(m,g);){if(o(m,g))l.push({row:m,col:g});else if(r(m,g)){l.push({row:m,col:g});break}else break;m+=c,g+=h}}}return l},endPlayerTurn(a){this.gameData.game=a.game,this.gameData.player1=a.player1,this.gameData.player2=a.player2,this.updatePlayerHand("player1",a.cardIndex),this.victoryState(),!this.gameData.winner&&(this.makeAIMove(),this.victoryState())},passTurn(){this.gameData.game.board.configuration.turn=this.gameData.game.board.configuration.turn==="white"?"black":"white",this.gameData.game.board.configuration.turn!==this.myColor&&(this.makeAIMove(),this.victoryState())},redrawCard(a,e){const t=this.gameData[a].hand;t.splice(e,1),this.gameData[a].hand=t,this.updatePlayerHand(a,e),this.passTurn(),this.selectedCardIndex=null},selectCard(a){this.selectedCardIndex===a?this.selectedCardIndex=null:this.selectedCardIndex=a},offerDraw(){this.gameData.offeredDraw=!0,console.log("Draw offered.")},appectDraw(){this.gameData.winner="draw",console.log("Draw accepted.")},resign(){console.log("Player resigned."),this.gameData.winner=this.gameData.game.board.configuration.turn==="white"?"black":"white"},leaveGame(){this.$router.push("/")},victoryState(){this.hasBlackKing?this.hasWhiteKing?this.isDraw?this.gameData.winner="draw":this.gameData.winner=null:this.gameData.winner="black":this.gameData.winner="white"}},computed:{player1Hand(){return this.gameData?this.gameData.player1.hand:[]},player2Hand(){return this.gameData?this.gameData.player2.hand:[]},myPlayer(){const a=localStorage.getItem("userId");return a===this.gameData.player1.userId?this.gameData.player1:a===this.gameData.player2.userId?this.gameData.player2:null},myCardHand(){return this.myPlayer?this.myPlayer.hand:null},myColor(){return this.myPlayer?this.myPlayer.color:null},hasBlackKing(){return this.gameData&&Object.values(this.gameData.game.board.configuration.pieces).includes("k")},hasWhiteKing(){return this.gameData&&Object.values(this.gameData.game.board.configuration.pieces).includes("K")},onlyKingsLeft(){if(this.gameData){const a=this.gameData.game.board.configuration.pieces;return Object.values(a).filter(e=>e!=="k"&&e!=="K").length===0}return!1},isDraw(){return!!(this.gameData&&(this.onlyKingsLeft||this.gameData.game.board.configuration.halfmove>=50||this.gameData.drawAccepted))},gameWinner(){return this.gameData&&this.gameData.winner?this.gameData.winner:null}}};function me(a,e,t,u,l,r){const o=ce,d=Y,n=ie,c=ne,h=ae;return f(),b(k,null,[s(p,null,{default:i(()=>[l.gameData?(f(),D(y,{key:0,cols:"3",class:"card-mangement"},{default:i(()=>[s(o,{myCardHand:r.myCardHand,myColor:r.myColor,cardTypes:l.cardTypes,onRedrawCard:r.redrawCard,onPassTurn:r.passTurn},null,8,["myCardHand","myColor","cardTypes","onRedrawCard","onPassTurn"])]),_:1})):x("",!0),s(y,{class:"game-board"},{default:i(()=>[s(p,{class:"chess-board-container"},{default:i(()=>[s(d,{gameData:l.gameData,gameId:l.gameId,onGameUpdated:r.endPlayerTurn},null,8,["gameData","gameId","onGameUpdated"])]),_:1})]),_:1}),l.gameData?(f(),D(y,{key:1,cols:"3",class:"game-mangement"},{default:i(()=>[s(n,{offeredDraw:this.gameData.offeredDraw,onOfferDraw:r.offerDraw,onResign:r.resign},null,8,["offeredDraw","onOfferDraw","onResign"]),e[0]||(e[0]=_("br",null,null,-1)),e[1]||(e[1]=_("br",null,null,-1)),s(c)]),_:1})):x("",!0)]),_:1}),r.gameWinner?(f(),D(h,{key:0,gameWinner:r.gameWinner,player1:this.gameData.player1,player2:this.gameData.player2,onClose:r.leaveGame},null,8,["gameWinner","player1","player2","onClose"])):x("",!0)],64)}const pe=v(ue,[["render",me],["__scopeId","data-v-13928a0f"]]);export{pe as default};
